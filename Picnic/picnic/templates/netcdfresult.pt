<html tal:define="hourformat '%H:%M:%S';dateformat '%B %e, %Y '+hourformat;">
	<head>
		<title>${session.name} NetCDF Creation ${'' if ('starttime' not in session or 'endtime' not in session) else (session.starttime.strftime(dateformat) + ' - ' + session.endtime.strftime(hourformat if session.starttime.date()==(session.endtime-timedelta(seconds=1)).date() else dateformat))} , range ${'' if ('altmin' not in session or 'altmax' not in session) else '%.0f - %.0f km' % (session.altmin/1000,session.altmax/1000) }</title>
	</head>
	<body>
		<center>
			<a href="http://lidar.ssec.wisc.edu/syst/ahsrl/about_image.htm">About these images</a><br />
${session.name} NetCDF Creation<BR/>Requested: ${'' if ('starttime' not in session or 'endtime' not in session) else (session.starttime.strftime(dateformat) + ' - ' + session.endtime.strftime(hourformat if session.starttime.date()==(session.endtime-timedelta(seconds=1)).date() else dateformat))} , range ${'' if ('altmin' not in session or 'altmax' not in session) else '%.0f - %.0f km' % (session.altmin/1000,session.altmax/1000) }
		</center>
		<center>
			<div tal:omit-tag="" tal:condition="nc!=None">
				<a tal:attributes="href request.route_path('session_resource',session=session.sessionid,filename=session.filename)" tal:content="session.filename" tal:condition="nc!=None"/>
				<BR/>
				<div tal:omit-tag="" tal:condition="('base_time' in nc.variables) and ('time' in nc.variables) and (len(nc.variables['time'])>0)">
					<div tal:omit-tag="" tal:define="base_time datetime(1970,1,1,0,0,0)+timedelta(seconds=int(nc.variables['base_time'][0]))">
						${(base_time + timedelta(seconds=nc.variables['time'][0])).strftime(dateformat)} - ${(base_time + timedelta(seconds=nc.variables['time'][-1])).strftime(dateformat)} (${len(nc.variables['time'])} records)
						<div tal:omit-tag="" tal:condition="(session.endtime-(base_time + timedelta(seconds=nc.variables['time'][-1]))).total_seconds()>(2*session.timeres)">
							<font color="#cc0000">NetCDF file is incomplete. <div tal:omit-tag="" tal:condition="'logfileurl' in session">Check the <a href="${session.logfileurl}">logfile</a>.</div></font>
						</div>
					</div>
				</div>
			</div>
			<div tal:omit-tag="" tal:condition="nc==None">
				<font color="#cc0000">Failed to create valid NetCDF file. <div tal:omit-tag="" tal:condition="'logfileurl' in session">Check the <a href="${session.logfileurl}">logfile</a>.</div></font>
			</div>
		</center>
		<a tal:condition="'logbookurl' in session" tal:attributes="href session.logbookurl">logbook entry</a><br />
		<center>
			<div tal:omit-tag="" tal:condition="len(imageurls)==0 and nc!=None">
				<font color="#cc0000">Image generation failed. <div tal:omit-tag="" tal:condition="'logfileurl' in session">Check the <a href="${session.logfileurl}">logfile</a>.</div></font>
			</div>
			<div tal:repeat="imurl imageurls">
  				<img src="${imurl if 'url' not in imurl else imurl.url}" alt="${'' if 'name' not in imurl else imurl.name}"/>
				<br /><br /><br /><br />
			</div>
		</center>
		<center>
			<a tal:repeat="jsonurl jsonurls" tal:attributes="href jsonurl if 'url' not in jsonurl else jsonurl.url" tal:content="'JSON' if 	'name' not in jsonurl else jsonurl.name"/>
		</center>
	    <a tal:condition="'logfileurl' in session" tal:attributes="href session.logfileurl">&lambda;</a><a tal:condition="nc!=None" href="${request.route_path('netcdfreimage',session=session.sessionid)}">Reimage</a>
	</body>
	${'' if nc==None else nc.close()}
</html>
